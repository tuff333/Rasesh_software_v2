{% extends 'base.html' %}
{% block content %}

<div id="workspace">

  <!-- LEFT SIDEBAR (TOOLS + THUMBNAILS) -->
  <div id="leftSidebar">

    <!-- Thumbnails -->
    <div class="tool-section">
      <h6>Pages</h6>
      <div id="thumbList"></div>
    </div>

    <!-- Redaction Tools -->
    <div class="tool-section">
      <h6>Redaction</h6>
      <button class="btn btn-sm btn-secondary w-100 mb-1" id="undoBtn">
        <i class="bi bi-arrow-counterclockwise"></i> Undo
      </button>
      <button class="btn btn-sm btn-danger w-100 mb-1" id="clearBtn">
        <i class="bi bi-trash"></i> Clear
      </button>
      <button class="btn btn-sm btn-info w-100 mb-1" id="previewAll">
        <i class="bi bi-grid"></i> Preview
      </button>
      <button class="btn btn-sm btn-success w-100" id="applyPreview">
        <i class="bi bi-check2-circle"></i> Apply
      </button>
    </div>

    <!-- Templates -->
    <div class="tool-section">
      <h6>Templates</h6>

      <!-- Save Template -->
      <button class="btn btn-sm btn-outline-primary w-100 mb-1" id="saveTemplateBtn">
        <i class="bi bi-save"></i> Save Template
      </button>

      <!-- Template Dropdown -->
      <select id="templateSelect" class="form-select form-select-sm mb-1">
        <option value="">Templates...</option>
      </select>

      <!-- Apply Template -->
      <button class="btn btn-sm btn-outline-secondary w-100 mb-1" id="applyTemplateAllBtn">
        Apply to All Pages
      </button>

      <button class="btn btn-sm btn-outline-secondary w-100 mb-1" id="applyTemplatePageBtn">
        Apply to This Page
      </button>

      <!-- NEW BUTTONS FOR EDITING TEMPLATES -->
      <button class="btn btn-sm btn-outline-warning w-100 mb-1" id="loadTemplateBtn">
        Load Template for Editing
      </button>

      <button class="btn btn-sm btn-outline-danger w-100" id="overwriteTemplateBtn">
        Overwrite Template
      </button>

    </div>

    <!-- OCR -->
    <div class="tool-section">
      <h6>OCR</h6>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="ocrToggle">
        <label class="form-check-label" for="ocrToggle">Enable OCR</label>
      </div>
    </div>

  </div>

  <!-- CENTER VIEWER -->
  <div id="centerViewer">

    <!-- PDF Viewer Frame -->
    <div id="viewerFrame">
      <canvas id="pdfCanvas"></canvas>
      <div id="overlay"></div>
    </div>

    <!-- BOTTOM NAVIGATION BAR -->
    <div id="bottomBar">

      <button class="btn btn-sm btn-outline-primary" id="prevPage">
        <i class="bi bi-arrow-left"></i>
      </button>

      <span class="page-display">
        Page <span id="pageNum">1</span> of <span id="pageCount">1</span>
      </span>

      <button class="btn btn-sm btn-outline-primary" id="nextPage">
        <i class="bi bi-arrow-right"></i>
      </button>

      <div class="zoom-controls ms-auto">
        <button class="btn btn-sm btn-outline-secondary" id="zoomOut">
          <i class="bi bi-zoom-out"></i>
        </button>

        <button class="btn btn-sm btn-outline-secondary" id="zoomReset">
          <i class="bi bi-aspect-ratio"></i>
        </button>

        <button class="btn btn-sm btn-outline-secondary" id="zoomIn">
          <i class="bi bi-zoom-in"></i>
        </button>
      </div>

    </div>

  </div>

  <!-- RIGHT SIDEBAR (AI SUGGESTIONS) -->
  <div id="rightSidebar">
    <h6>AI Suggestions</h6>
    <div id="suggestions"></div>
  </div>

</div>

<!-- Multi-page Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Redaction Preview (All Pages)</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" id="previewPages"></div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button class="btn btn-success" id="applyPreviewFromModal">
          Apply Redactions
        </button>
      </div>

    </div>
  </div>
</div>

<script>
  window.filename = "{{ filename }}";
  window.pageCount = {{ pages }};
</script>

<script src="{{ url_for('static', filename='js/redactor.js') }}"></script>

{% endblock %}
