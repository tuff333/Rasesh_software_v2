{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">

  <!-- TOP CARDS -->
  <div class="row g-3 mb-4">

    <!-- CONTACTS -->
    <div class="col-md-3">
      <a href="{{ url_for('contacts.contacts_list') }}" class="text-decoration-none">
        <div class="card shadow-sm border-primary">
          <div class="card-body text-center">
            <i class="bi bi-people fs-1 text-primary"></i>
            <h5 class="mt-2">Contacts</h5>
          </div>
        </div>
      </a>
    </div>

    <!-- INVOICE -->
    <div class="col-md-3">
      <a href="{{ url_for('invoice_routes.invoice_list') }}" class="text-decoration-none">
        <div class="card shadow-sm border-success">
          <div class="card-body text-center">
            <i class="bi bi-journal-text fs-1 text-success"></i>
            <h5 class="mt-2">Invoices</h5>
          </div>
        </div>
      </a>
    </div>

    <!-- REDACTOR -->
    <div class="col-md-3">
      <a href="{{ url_for('redactor.upload_page') }}" class="text-decoration-none">
        <div class="card shadow-sm border-warning">
          <div class="card-body text-center">
            <i class="bi bi-pencil-square fs-1 text-warning"></i>
            <h5 class="mt-2">Document Redaction</h5>
          </div>
        </div>
      </a>
    </div>

    <!-- MANIFEST -->
    <div class="col-md-3">
      <a href="{{ url_for('manifest.manifest_registry') }}" class="text-decoration-none">
        <div class="card shadow-sm border-danger">
          <div class="card-body text-center">
            <i class="bi bi-box-seam fs-1 text-danger"></i>
            <h5 class="mt-2">Manifests</h5>
          </div>
        </div>
      </a>
    </div>

  </div>

  <!-- INVOICE LIST EMBEDDED -->
  <div class="card shadow mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-journal-text"></i> Recent Invoices</h5>
      <a href="{{ url_for('invoice.invoice_create') }}" class="btn btn-success btn-sm">
        <i class="bi bi-plus-circle"></i> New Invoice
      </a>
    </div>

    <div class="card-body">

      <table class="table table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Invoice #</th>
            <th>Date</th>
            <th>Vendor</th>
            <th>Type</th>
            <th>Total</th>
            <th>PDF</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for inv in recent_invoices %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ inv.num }}</td>
            <td>{{ inv.date }}</td>
            <td>{{ inv.vendor }}</td>
            <td>{{ inv.invoice_type }}</td>
            <td>${{ "%.2f"|format(inv.total) }}</td>

            <td>
              {% if inv.pdf %}
                <a href="{{ url_for('invoice_routes.invoice_download', filename=inv.pdf) }}"
                   class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-file-earmark-pdf"></i>
                </a>
              {% else %}
                <span class="text-muted">None</span>
              {% endif %}
            </td>

            <td class="text-end">
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle"
                        data-bs-toggle="dropdown">
                  Actions
                </button>

                <ul class="dropdown-menu dropdown-menu-end">

                  <li>
                    <a class="dropdown-item"
                       href="{{ url_for('invoice_routes.invoice_view', invoice_id=inv.id) }}">
                      View
                    </a>
                  </li>

                  <li>
                    <a class="dropdown-item"
                       href="{{ url_for('invoice_routes.invoice_edit', invoice_id=inv.id) }}">
                      Edit
                    </a>
                  </li>

                  <li>
                    <a class="dropdown-item"
                       href="{{ url_for('invoice_routes.invoice_duplicate', invoice_id=inv.id) }}">
                      Duplicate
                    </a>
                  </li>

                  <li><hr class="dropdown-divider"></li>

                  <li>
                    {% if inv.pdf %}
                      <a class="dropdown-item"
                         href="{{ url_for('invoice_routes.invoice_download', filename=inv.pdf) }}">
                        Download PDF
                      </a>
                    {% else %}
                      <span class="dropdown-item text-muted">No PDF</span>
                    {% endif %}
                  </li>

                  <li>
                    <a class="dropdown-item"
                       href="{{ url_for('invoice.invoice_send_email', invoice_id=inv.id) }}">
                      Send Email
                    </a>
                  </li>

                  <li><hr class="dropdown-divider"></li>

                  <li>
                    <form method="POST"
                          action="{{ url_for('invoice_routes.invoice_delete', invoice_id=inv.id) }}"
                          onsubmit="return confirm('Delete this invoice?');">
                      <button class="dropdown-item text-danger" type="submit">
                        Delete
                      </button>
                    </form>
                  </li>

                </ul>
              </div>
            </td>

          </tr>
          {% endfor %}
        </tbody>

      </table>

    </div>
  </div>

</div>

{% endblock %}
