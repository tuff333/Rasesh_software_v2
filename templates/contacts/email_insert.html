{% extends 'base.html' %}
{% block content %}

<div class="card shadow" style="max-width: 800px; margin: auto;">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5>
      <i class="bi bi-envelope"></i>
      Email to {{ contact.first_name_contact }} {{ contact.last_name_contact }}
    </h5>
    <a href="{{ url_for('contacts.view_contact', id=contact.id) }}" class="btn btn-sm btn-secondary">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>

  <div class="card-body">

    <div class="mb-3">
      <label class="form-label fw-semibold">To</label>
      <input type="email"
             class="form-control"
             value="{{ contact.email_contact or '' }}"
             readonly>
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold">Subject</label>
      <input type="text"
             class="form-control"
             id="email-subject"
             value="{{ template.subject }}">
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold">Body</label>
      <textarea class="form-control"
                rows="12"
                id="email-body">{{ filled_body }}</textarea>
    </div>

    <button class="btn btn-primary" type="button" onclick="openMailto()">
      <i class="bi bi-envelope-open"></i> Open in Email Client
    </button>

  </div>
</div>

<script>
function openMailto() {
  const to = "{{ contact.email_contact or '' }}";
  const subject = encodeURIComponent(document.getElementById('email-subject').value || '');
  const body = encodeURIComponent(document.getElementById('email-body').value || '');
  window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
}
</script>

{% endblock %}
