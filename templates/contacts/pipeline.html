{% extends 'base.html' %}
{% block content %}

<div class="card shadow">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5><i class="bi bi-kanban"></i> Contact Pipeline</h5>
    <a href="{{ url_for('contacts.contacts_list') }}" class="btn btn-sm btn-secondary">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>

  <div class="card-body">

    <div class="d-flex flex-row flex-nowrap gap-3" style="overflow-x: auto;">

      {% set stages = ['new','contacted','qualified','proposal','won','lost'] %}

      {% for st in stages %}
      <div class="card shadow-sm" style="min-width: 260px;">
        <div class="card-header text-capitalize fw-semibold">
          {{ st }}
        </div>

        <div class="card-body" style="max-height: 70vh; overflow-y: auto;">

          {% for c in board[st] %}
          <div class="card mb-2">
            <div class="card-body p-2 d-flex align-items-center">

              <!-- Avatar -->
              <div class="rounded-circle text-white d-flex justify-content-center align-items-center me-2"
                   style="
                     width: 34px;
                     height: 34px;
                     font-size: 14px;
                     background: {{ c.avatar_color }};
                   ">
                {{ c.name.split(' ')[0][:1] }}{{ c.name.split(' ')[-1][:1] }}
              </div>

              <div class="flex-grow-1">
                <div class="fw-semibold">{{ c.name }}</div>
                <div class="small text-muted">{{ c.company or '' }}</div>

                <!-- Status badge -->
                {% set s = c.status or 'active' %}
                {% if s == 'active' %}
                  <span class="badge bg-success">Active</span>
                {% elif s == 'lead' %}
                  <span class="badge bg-info text-dark">Lead</span>
                {% elif s == 'customer' %}
                  <span class="badge bg-primary">Customer</span>
                {% elif s == 'inactive' %}
                  <span class="badge bg-secondary">Inactive</span>
                {% else %}
                  <span class="badge bg-dark">{{ s }}</span>
                {% endif %}
              </div>

              <a href="{{ url_for('contacts.view_contact', id=c.id) }}"
                 class="btn btn-sm btn-outline-secondary ms-2">
                <i class="bi bi-box-arrow-up-right"></i>
              </a>

            </div>
          </div>
          {% else %}
          <div class="text-muted small">No contacts in this stage.</div>
          {% endfor %}

        </div>
      </div>
      {% endfor %}

    </div>

  </div>
</div>

{% endblock %}
